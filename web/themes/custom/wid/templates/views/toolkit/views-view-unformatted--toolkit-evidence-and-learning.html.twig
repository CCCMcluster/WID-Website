{#
/**
 * @file
 * Theme override to display a view of unformatted rows.
 *
 * Available variables:
 * - title: The title of this group of rows. May be empty.
 * - rows: A list of the view's row items.
 *   - attributes: The row's HTML attributes.
 *   - content: The row's content.
 * - view: The view object.
 * - default_row_class: A flag indicating whether default classes should be
 *   used on rows.
 *
 * @see template_preprocess_views_view_unformatted()
 */
#}
{% if view.current_display  == 'evidence_and_learning_workshop_tools' %}
  <div class="toolkit-evidence-body-wrapper py-5 my-5">
    <div class="toolkit-evidence-body-wrapper py-5 my-5">
      <div class="container">
        <div class="workshop-content">
          <div class="workshop-title">
            {{ title }}
          </div>
          <div class="workshop-row-wrapper pt-5 px-4">
            {% for row in rows %}
              <div class="workshop-row row mb-5">
                {% set entity = row.content['#row']._entity %}
                {% set title = entity.title.value %}
                {% set description = entity.body.summary %}
                {% set created_date = entity.created.value | format_date('custom_document_date') %}
                {% set toolkitLink = path('entity.node.canonical', {'node': entity.nid.value}) %}
                {% if entity.field_toolkit_cover_img.value %}
                  <img class="col-sm-12 col-md-12 col-lg-5 w-100 p-0 image-container"
                       src="{{ file_url(entity.field_toolkit_cover_img.entity.field_media_image.entity.fileuri|image_style('hd')) }}"
                       alt="{{ entity.field_toolkit_cover_img.entity.field_media_image.alt }}">
                {% endif %}
                <div class="col-sm-12 col-md-12 col-lg-7 workshop-row-content p-5">
                  <a href="{{ toolkitLink }}"><h3 class="workshop-row-title">{{ title }}</h3></a>
                  <p class="workshop-row-body py-3">
                    {{ description|length > 425 ? description|slice(0, 425) ~ '...' : description }}
                  </p>
                  <div class="row m-2 file-info-container py-3 px-3">
                    <div class="col-sm-10">
                      <h2 class="file-info-title">{{ title }}</h2>
                      <div>
                        <span><i class="fa fa-calendar-o pr-2" aria-hidden="true"></i>{{ created_date }}</span>
                        {% if entity.field_toolkit_attachment_type.value == 'Document' %}
                          {% set fileSize = entity.field_toolkit_document.entity.field_media_document.entity.filesize.value/1024 %}
                          <span><i class="fa fa-file-text-o pr-2"
                                   aria-hidden="true"></i>{{ fileSize|round(1, 'ceil') }}KB</span>
                        {% endif %}
                      </div>
                    </div>
                    <div class="col-sm-2 button-container">
                      {% if entity.field_toolkit_attachment_type.value == 'Document' %}
                        {% set fileExtension = media_file_type(entity.field_toolkit_document.value.0.target_id, 'field_media_document') %}
                        <img class="extension-icon mb-2" src="/{{ directory }}/images/icons/{{ fileExtension }}.svg"
                             alt={{ fileExtension }}>
                        {% set document_url = media_file_url(entity.field_toolkit_document.value.0.target_id, 'field_media_document') %}
                        <span><a class="download-button" href="{{ document_url }}" download>Download</a></span>
                      {% elseif entity.field_toolkit_attachment_type.value == 'Link' %}
                        <span><a class="download-button" href="{{ entity.field_toolkit_document[0].uri }}"
                                 download>Download</a></span>
                      {% endif %}
                    </div>
                  </div>
                </div>
              </div>
            {% endfor %}
          </div>
        </div>
      </div>
    </div>
  </div>
{% endif %}

{% if view.current_display  == 'evidence_and_learning_workshop' %}
  {% if title %}
    {% set view_index_max = max(view.result|keys) %}
    {% set view_index = rows|keys.0 %}
    {% set tidIndex = rows|keys|first %}
    {% set evidenceLearningTid = attribute(rows, tidIndex).content['#row']._entity.field_toolkit.target_id %}
    {% if evidenceLearningTid %}
      {% set evidenceLearningTerm = load_tax_term(evidenceLearningTid) %}
      {% set evidenceLearningImg = file_url(evidenceLearningTerm.field_toolkit_img.entity.field_media_image.entity.fileuri) %}
      {% set evidenceLearningCoverAlt = evidenceLearningTerm.field_toolkit_img.entity.field_media_image.alt %}
    {% endif %}
    {% if view_index == 0 %}
      <div class="toolkit-evidence-body-wrapper py-5 my-5">
      <div class="container">
    {% endif %}
    <div class="workshop-content {{ evidenceLearningTerm.name.value|lower|replace(' ', '-') ~ '-content' }}">
      <div class="workshop-title">{{ title }}</div>
      <div class="workshop-row-wrapper pt-5 px-4">
        <div class="workshop-row row mb-5">
          <img class="col-sm-12 col-md-12 col-lg-5 w-100 p-0 image-container" src="{{ evidenceLearningImg }}"
               alt="{{ evidenceLearningCoverAlt }}">
          <div class="col-sm-12 col-md-12 col-lg-7 workshop-row-content p-5">
            <h3 class="workshop-row-title">{{ evidenceLearningTerm.name.value }}</h3>
            <p class="workshop-row-body py-3">
              {% autoescape false %}
                {{ evidenceLearningTerm.description.value }}
              {% endautoescape %}
            </p>
            {% for row in rows %}
              {% set entity = row.content['#row']._entity %}
              {% set title = entity.title.value %}
              {% set created_date = entity.created.value | format_date('custom_document_date') %}
              {% set toolkitLink = path('entity.node.canonical', {'node': entity.nid.value}) %}
              <div class="row m-2 file-info-container py-3 px-3">
                <div class="col-sm-10">
                  <a href="{{ toolkitLink }}"><h2 class="file-info-title">{{ title }}</h2></a>
                  <div>
                    <span><i class="fa fa-calendar-o pr-2" aria-hidden="true"></i>{{ created_date }}</span>
                    {% if entity.field_toolkit_attachment_type.value == 'Document' %}
                      {% set fileSize = entity.field_toolkit_document.entity.field_media_document.entity.filesize.value/1024 %}
                      <span><i class="fa fa-file-text-o pr-2"
                               aria-hidden="true"></i>{{ fileSize|round(1, 'ceil') }}KB</span>
                    {% endif %}
                  </div>
                </div>
                <div class="col-sm-2 button-container">
                  {% if entity.field_toolkit_attachment_type.value == 'Document' %}
                    {% set fileExtension = media_file_type(entity.field_toolkit_document.value.0.target_id, 'field_media_document') %}
                    <img class="extension-icon mb-2" src="/{{ directory }}/images/icons/{{ fileExtension }}.svg"
                         alt={{ fileExtension }}>
                    {% set document_url = media_file_url(entity.field_toolkit_document.value.0.target_id, 'field_media_document') %}
                    <span><a class="download-button" href="{{ document_url }}" download>Download</a></span>
                  {% elseif entity.field_toolkit_attachment_type.value == 'Link' %}
                    <span><a class="download-button" href="{{ entity.field_toolkit_document_link[0].uri }}"
                             target="_blank">Download</a></span>
                  {% endif %}
                </div>
              </div>
            {% endfor %}
          </div>
        </div>
      </div>
    </div>
    {% if rows|keys|last == view_index_max %}
      <div class="testimonial-slide-content">
        <h1 class="testimonial-slide-content-title mb-4">Testimonials from Beneficiaries:</h1>
        <div id="toolkitTestimonialSlide" class="carousel slide" data-ride="carousel">
          <div class="carousel-inner" role="listbox">
            {% set testimonials = drupal_view_result('testimonial','block_2') %}
            {% for testimonial in testimonials %}
              {% set testimonial_entity = testimonial._entity %}
              <div class="carousel-item">
                <img class="quote-image" src="/{{ directory }}/images/icons/testimonial-bg.svg"
                     alt="quote" />
                <div class="card my-2">
                  <div class="testimonial-title">
                    {{ testimonial_entity.field_testimonial_name.value|capitalize ~ ', ' ~ testimonial_entity.field_testimonial_region.entity.name.value }}
                  </div>
                  <div class="testimonial-body">
                    {% autoescape false %}
                      {{ testimonial_entity.body.value }}
                    {% endautoescape %}
                  </div>
                  <div class="testimonial-source">
                    {{ testimonial_entity.field_testimonial_position.value }}
                  </div>
                </div>
              </div>
            {% endfor %}
          </div>
          <a class="control-left" href="#toolkitTestimonialSlide" role="button" data-slide="prev">
            <i class="fa fa-arrow-left"></i>
          </a>
          <a class="control-right" href="#toolkitTestimonialSlide" role="button" data-slide="next">
            <i class="fa fa-arrow-right"></i>
          </a>
          <ul id="toolkitTestimonialSlideIndicator" class="carousel-indicators">
            {% for testimonial in testimonials %}
              <li class="item-indicator" data-target="#toolkitTestimonialSlide"
                  data-slide-to="{{ loop.index-1 }}"></li>
            {% endfor %}
          </ul>
        </div>
      </div>
      </div>
      </div>
    {% endif %}
  {% endif %}
{% endif %}
